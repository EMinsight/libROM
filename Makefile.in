###############################################################################
##
## This file is part of the CAROM distribution.  For full copyright
## information, see COPYRIGHT.
##
## Copyright:   (c) 2013-2015 Lawrence Livermore National Security, LLC
## Description: Makefile for the entire CAROM distribution.
##
###############################################################################

.SUFFIXES: .o .C

LIBROM = libROM.a

CXX		= @CXX@
CXXFLAGS	= @CXX_FLAGS@
CPPFLAGS	= @CPPFLAGS@ @INC_PATH@
LDFLAGS		= @LD_FLAGS@ @LIB_PATH@
LDLIBS		= $(LIBROM) @LIB_NAME@
AR		= @AR@

OBJS = Matrix.o \
       Vector.o \
       BasisReader.o \
       BasisWriter.o \
       SVDBasisGenerator.o \
       SVDSampler.o \
       SVD.o \
       IncrementalSVD.o \
       IncrementalSVDFastUpdate.o \
       IncrementalSVDStandard.o \
       IncrementalSVDBasisGenerator.o \
       IncrementalSVDSampler.o \
       StaticSVD.o \
       StaticSVDBasisGenerator.o \
       StaticSVDSampler.o \
       Database.o \
       HDFDatabase.o \
       Utilities.o \
       ParallelBuffer.o

default: lib

all: lib uneven_dist random_test weak_scaling smoke_test

lib: $(OBJS)
	ar ru $(LIBROM) $(OBJS)

uneven_dist: lib uneven_dist.o
	$(CXX) $(LDFLAGS) -o uneven_dist uneven_dist.o $(LDLIBS)

random_test: lib random_test.o
	$(CXX) $(LDFLAGS) -o random_test random_test.o $(LDLIBS)

weak_scaling: lib weak_scaling.o
	$(CXX) $(LDFLAGS) -o weak_scaling weak_scaling.o $(LDLIBS)

smoke_test: lib smoke_test.o
	$(CXX) $(LDFLAGS) -o smoke_test smoke_test.o $(LDLIBS)

.C.o :
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) -c $*.C

clean:
	rm -f *.o $(LIBROM) uneven_dist random_test weak_scaling smoke_test

dox:
	(cd docs && $(MAKE) $@)

include Makefile.depend
